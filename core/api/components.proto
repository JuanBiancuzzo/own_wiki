syntax = "proto3";
package api;

option go_package = "github.com/JuanBiancuzzo/own_wiki/core"; 

// Describes the structure of the data define by the user
message ComponentStructure {
    string name = 1;
    repeated FieldStructure fields = 2;
}

// The all possible types of a field
enum FieldType {
    INT = 0;
    STRING = 1;
    CHAR = 2;
    BOOL = 3;
    DATE = 4;
    REFERENCE = 5;
}

// Represents a type of data that could be represented and save by the system
message FieldStructure {
    string name = 1;
    FieldType type = 2;
    optional FieldStructure reference = 3;
    bool is_null = 4;
    bool is_key = 5;
}

// Represents the construction of a entity, that could be a Component, or a composition of components
message EntityDescription {
    oneof description {
        ComponentDescription component = 1;
        ComponentCompositionDescription composition = 2;
    }
}

// Represents the composition of components, and it's a recursive definition
message ComponentCompositionDescription {
    repeated EntityDescription entities = 1;
}

// Represents the data of the component
message ComponentDescription {
    enum DataAmount {
        POINT = 0;
        ARRAY = 1;
    }

    string name = 1;
    ComponentStructure structure = 2;
    DataAmount amount = 3;
    int32 rows = 4;
    FieldsDescription fields = 5;
}

// Represents the 
message FieldsDescription {
    repeated FieldDescription fields = 5;
}

// Represents the data of a field in a query result (array of values)
message FieldDescription {

    message ConcreteFieldData {
        oneof data {
            int32 number = 1;
            string text = 2;
            string character = 3;
            bool boolean = 4;
            uint32 date = 5;
            FieldsDescription reference = 6;
        }
    }

    message NullableFieldData {
        optional ConcreteFieldData data = 1;
    }

    message FieldData {
        oneof data {
            ConcreteFieldData concrete = 1;
            NullableFieldData nullable = 2;
        }
    }

    message FieldDataArray {
        repeated FieldData data_array = 1;
    }

    string name = 1;
    // This should be all of the same type. This is to save space and
    // not have the type information in the FieldData
    oneof data {
        FieldData point = 2;
        FieldDataArray array = 3;
    }
}