syntax = "proto3";
package api;

option go_package = "github.com/JuanBiancuzzo/own_wiki/core"; 

// Describes the structure of the data define by the user
message ComponentStructure {
    string name = 1;
    repeated FieldStructure fields = 2;
}

// Represents a type of data that could be represented and save by the system
message FieldStructure {
    string name = 1;
    FieldTypeInformation type_information = 2;
    bool is_null = 3;
    bool is_key = 4;
}


// The primitive types of a field
enum PrimitiveFieldType {
    // First are the not nullable, and then the nullable, this is to be 
    // able to get the nullability of the type by the NULL_INT value
    INT = 0;
    STRING = 1;
    CHAR = 2;
    BOOL = 3;
    DATE = 4;
    NULL_INT = 5;
    NULL_STRING = 6;
    NULL_CHAR = 7;
    NULL_BOOL = 8;
    NULL_DATE = 9;
}

// The information necesary to reference a table
message ReferenceInformation {
    string table_name = 1;
}

// Represents the type information of the data
message FieldTypeInformation {
    enum FieldType {
        PRIMITIVE = 0;
        REFERENCE = 1;
    }

    FieldType type = 1;
    oneof information {
        PrimitiveFieldType primitive = 2;
        ReferenceInformation reference = 3;
    }
}

// Represents the construction of a entity, that could be a Component, or a composition of components
message EntityDescription {
    oneof description {
        ComponentDescription component = 1;
        ComponentCompositionDescription composition = 2;
    }
}

// Represents the composition of components, and it's a recursive definition
message ComponentCompositionDescription {
    repeated EntityDescription entities = 1;
}

// Represents the data of the component
message ComponentDescription {
    string name = 1;

    enum DataAmount {
        ONE = 0;
        ARRAY = 1;
    }

    DataAmount amount = 2;
    int32 rows = 3;
    repeated FieldDescription fields = 4;
}

// Represents the data of a field in a query result (array of values)
message FieldDescription {
    string name = 1;
    FieldTypeInformation type_information = 2;

    // If the type is primitive, then the data is store as that, but 
    // if the type is a reference, then is ComponentDescription
    message ConcreteFieldData {
        oneof data {
            int32 number = 1;
            string text = 2;
            string character = 3;
            bool boolean = 4;
            uint32 date = 5;
            ComponentDescription reference = 6;
        }
    }

    message NullableFieldData {
        optional ConcreteFieldData data = 1;
    }

    message FieldData {
        oneof data {
            ConcreteFieldData concrete = 1;
            NullableFieldData nullable = 2;
        }
    }

    message FieldDataArray {
        repeated FieldData data_array = 1;
    }

    // This should be all of the same type. This is to save space and
    // not have the type information in the FieldData
    oneof data {
        FieldData point = 3;
        FieldDataArray array = 4;
    }
}