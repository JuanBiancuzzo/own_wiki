syntax = "proto3";
package api;

option go_package = "github.com/JuanBiancuzzo/own_wiki/core"; 

// Describes the structure of the data define by the user
message ComponentStructure {
    string name = 1;
    repeated FieldStructure fields = 2;
}

// Represents a type of data that could be represented and save by the system
message FieldStructure {
    string name = 1;
    FieldTypeInformation type_information = 2;
    bool is_null = 3;
    bool is_key = 4;
}


// The primitive types of a field
enum PrimiteFieldType {
    INT = 0;
    STRING = 1;
    CHAR = 2;
    BOOL = 3;
    DATE = 4;
}

// The information necesary to reference a table
message ReferenceInformation {
    string table_name = 1;
}

// Represents the type information of the data
message FieldTypeInformation {
    enum FieldType {
        PRIMITIVE = 0;
        REFERENCE = 1;
    }

    FieldType type = 1;
    oneof information {
        PrimiteFieldType primitive = 2;
        ReferenceInformation reference = 3;
    }
}

// Represents the composition of components, and the value store
message EntityDescription {
    message EntityElement {
        oneof description {
            ComponentDescription component = 1;
            EntityDescription entity = 2;
        }
    }

    repeated EntityElement entities = 1;
}


// Represents the data of the component
message ComponentDescription {
    string name = 1;
    repeated FieldDescription fields = 2;
}

// Represents the data of a field in a query result (array of values)
message FieldDescription {
    string name = 1;
    FieldTypeInformation type_information = 2;

    // If the type is primitive, then the data is store as that, but 
    // if the type is a reference, then is ComponentDescription
    message FieldData {
        oneof data {
            int32 number = 1;
            string text = 2;
            string character = 3;
            bool boolean = 4;
            uint32 date = 5;
            ComponentDescription reference = 6;
        }
    }

    // This should be all of the same type. This is to save space and
    // not have the type information in the FieldData
    repeated FieldData data = 3;
}